using System.Collections.Generic;
using System.Text.RegularExpressions;

namespace DeckTracker.Domain.TheElderScrollsLegends
{
    public enum Attribute : uint
    {
        ActiveTitle = 1000100,
        AdvancedTitle = 1000112,
        ActiveCharacter = 1000101,
        ActivationsNeeded = 1000110,
        AchievementTags = 1000120,
        AssociatedTitle = 1000102,
        PlayerCharacters = 1000103,
        PlayerRace = 1000104,
        GeneralStatStorage = 1000105,
        LifetimeRankedWins = 1000106,
        LifetimeArenaWins = 1000107,
        BestRankedRanks = 1000108,
        BestArenaRanks = 1000109,
        AbilityEffectList = 105090,
        HydraMandatoryDeck = 103371,
        HydraReplayDeck = 103372,
        AdventurePvEELOScore = 401676,
        AdventurePvEGameCount = 401677,
        AdventurePvEGameWins = 401678,
        AdventurePvELastPlayedTime = 401679,
        AdventurePvETier = 401691,
        AdventurePvPTier = 401692,
        AdventurePvEWinLoseStreak = 401680,
        OrigDeckDefinition = 105083,
        ShadowFor = 105082,
        GroupWithProduct = 10960,
        OpenProductsInstead = 10970,
        HydraNodeCount = 103721,
        HydraLeftLaneSizeMod = 105052,
        HydraRightLaneSizeMod = 105053,
        HydraScenarioRules = 105051,
        AccountGuildID = 10430,
        AccountLastLogoutTime = 10380,
        AccountLevel = 10420,
        AccountLevelXP = 10400,
        AccountPreviousLevelXP = 10410,
        AccountSettings = 10230,
        AccountXP = 10390,
        AdditionalSearchTokens = 10921,
        IsFullyProgressedCard = 103291,
        Administrator = 10240,
        LandingFullUnlock = 401681,
        LandingSceneUnlock = 401690,
        QuestUnlock = 401682,
        BattleUnlock = 401683,
        SoloArenaUnlock = 401684,
        VersusArenaUnlock = 401685,
        GlossaryUnlocked = 401686,
        TitleUnlocked = 401687,
        AIAdeptUnlock = 401688,
        AIExpertUnlock = 401689,
        AdventureELOScore = 103730,
        AdventureGameCount = 103750,
        AdventureGameWins = 103760,
        AdventureLastOpponentID = 103740,
        AdventureLastPlayedTime = 103770,
        AdventureModeDeckDifficulty = 104460,
        AdventureModeDeckOkAvatars = 104440,
        AdventureWinLoseStreak = 103780,
        ArchID = 10000,
        AvailableOnDate = 10560,
        HydraAvailableAfterIntervalIndex = 105120,
        Banned = 10250,
        ContainerType = 105084,
        Birthdate = 10290,
        Campaign = 10010,
        CanTrade = 10260,
        CannotChangeAvatar = 103631,
        CannotCloneDeck = 10940,
        CannotDeleteDeck = 10750,
        CannotEditDeck = 10760,
        CannotRenameDeck = 10930,
        CannotBeDamagedByFilters = 103310,
        CardImage = 10020,
        CardNumber = 10030,
        CardProgressionOffers = 103300,
        CardProgressionUpgrades = 103290,
        Catalog = 10280,
        CatalogID = 10570,
        ClientStartsMission = 10440,
        CompletionRequirements = 10040,
        ConquestModeInDraft = 103790,
        CountryCode = 10300,
        CraftingPermitFor = 1000159,
        CustomNumber = 10050,
        DeckArchetype = 104450,
        DeckArchetypeList = 10830,
        DeckDefinitionID = 10820,
        DeckNameAutoGenerated = 105093,
        LastUsedDeck = 105091,
        DeckEntryID = 10770,
        DeckName = 10800,
        DeckTags = 10910,
        DeckUnlockType = 10810,
        DeckVersion = 10780,
        DeliverableType = 10700,
        Description = 10060,
        DisplayArchetype = 10070,
        Email = 10310,
        EntryPacks = 10740,
        EntryRequirements = 10080,
        EulaVersion = 10480,
        Free = 103440,
        FriendList = 10320,
        Gender = 10220,
        GoldCurrency = 103950,
        ArenaTicket = 103961,
        GuestAccount = 200005,
        GuildMessage = 10880,
        GuildPointsMap = 104010,
        GuildQuestAwardTime = 104020,
        GuildQuestCompletedCount = 104070,
        GuildQuestCurrent = 104040,
        GuildQuestLastUpdated = 104000,
        GuildQuestOfferAttribute = 104030,
        GuildQuestStreakBonus = 104090,
        Hidden = 10090,
        HydraAIDifficulty = 103630,
        HydraAIFlags = 103280,
        HydraAIInPlayTextbox = 105010,
        HydraAIInPlayTurnOrderPriority = 103610,
        NewPlayerQuestOrder = 104201,
        HydraAIMinValue = 105030,
        HydraAIOutOfPlayTextbox = 105020,
        HydraAIOutOfPlayTurnOrderPriority = 103620,
        HydraAIStaticValueTextbox = 105021,
        UnshackleOnRound = 105092,
        HydraAdditionalHangers = 103940,
        HydraArea = 103130,
        HydraAttackCount = 103260,
        HydraAvailableAfterCampaignNode = 105041,
        HydraBolsterValue = 103160,
        HydraCampaignDeckFormat = 103380,
        HydraCampaignDeckFormatSelectable = 104500,
        HydraCampaignDeckNumber = 103530,
        HydraCampaignDeckSuggestion = 105050,
        HydraCampaignFlags = 103910,
        HydraCampaignNodeName = 103400,
        HydraCanAttack = 103480,
        HydraCardType = 103050,
        HydraColorList = 103020,
        HydraColorLocks = 103520,
        HydraControllingPlayer = 103230,
        HydraCost = 103060,
        HydraCurrentTurnPlayer = 104490,
        HydraDeathInfoAttr = 103250,
        HydraDisconnectLoseTurn = 104480,
        HydraEdictCharges = 103330,
        HydraGameText = 103030,
        HydraGenericCounters = 103210,
        HydraGuildAffiliation = 105100,
        HydraGuildName = 104050,
        HydraHangerDisplayText = 104105,
        HydraHasCompletedCampaign = 104081,
        HydraHasCompletedFunnel = 104080,
        HydraHealth = 103080,
        HydraHealthBonus = 103500,
        HydraHiddenFromDeckbuilder = 105040,
        HydraIsAttacking = 104470,
        HydraIsCampaign = 103510,
        HydraIsDefending = 104471,
        HydraIsFavorite = 103340,
        HydraIsGoldenPath = 103420,
        HydraKeywordList = 103140,
        HydraKeywordReferenceCount = 103270,
        HydraRemovedKeywords = 103271,
        HydraLaneWidth = 103240,
        HydraLevelUpFilter = 103640,
        HydraMana = 103090,
        HydraMaxMana = 103100,
        HydraMultiNodeNumber = 103600,
        HydraNodeNumber = 103720,
        HydraNotForNewPlayers = 104200,
        HydraOutOfPlayAbilities = 103220,
        HydraPendingProphecies = 103350,
        HydraPhase = 103070,
        HydraPlayAbilities = 103110,
        HydraPostCompletionDescription = 103470,
        HydraPreconstructedDecks = 103370,
        HydraRarity = 103320,
        HydraReferencedArchs = 104104,
        HydraResponseAbilities = 103000,
        HydraRoundNumber = 103040,
        HydraScenarioType = 103390,
        HydraStaminaGemCount = 103081,
        HydraStatus = 103120,
        HydraSFX = 104106,
        HydraStreakBonus = 104100,
        HydraStrength = 103150,
        HydraStrengthBonus = 103490,
        HydraSubtitle = 103360,
        HydraSubtypeList = 103299,
        HydraSupertypeList = 103170,
        HydraSuppressEffectList = 103180,
        HydraTopShield = 103190,
        HydraTriggeredAbilities = 103010,
        IPAddress = 10460,
        ImageURL = 10510,
        InPlay = 10110,
        IsBase = 10120,
        IsDeleted = 10130,
        IsNPC = 10620,
        IsPremium = 104102,
        IsPresentingClone = 104109,
        IsTradable = 10640,
        IsTutorial = 10720,
        LastCollectionLossTime = 10470,
        LastPlayedScenarioID = 103450,
        LastUncompletedGoldenPathScenarioID = 103460,
        LastValidatedDate = 10870,
        Level = 10330,
        LocalAddress = 10340,
        MaximumNumberOfPurchases = 10580,
        ModifiesAttributes = 10710,
        Mute = 10270,
        MuteLevel = 10275,
        Name = 10140,
        NextGuildLevelReward = 104060,
        NoNameChange = 10840,
        NumberOfCardsInBooster = 10200,
        NumberOfGames = 10150,
        NumberOfGamesLost = 10160,
        QuestModeInDraft = 103800,
        OnlineStatus = 10350,
        OverrideSellbackCost = 1000154,
        SoulGemsCurrency = 103960,
        OtherVersions = 104101,
        Parent = 10170,
        ParentEmail = 10315,
        PauseClock = 10550,
        PlayerNumber = 10530,
        PlayHistorySource = 105060,
        PlayHistoryTargets = 105070,
        PlayHistoryEventType = 105080,
        PreviousCollectionIDs = 10370,
        Price = 77381929,
        ProductPrice = 1164969402,
        ProductSortOrder = 10500,
        ProductType = 10540,
        ProductURL = 10520,
        Purchaseable = 10490,
        RealCurrency = 2012906479,
        ReferencedCardText = 1000111,
        Rewards = 10630,
        RewardsCapLosses = 104120,
        RewardsCapLossesTs = 104140,
        RewardsCapWins = 104110,
        RewardsCapWinsTs = 104130,
        Role = 10485,
        RunOnce = 10100,
        ScenID = 10180,
        ScreenName = 10360,
        SelectedAvatar = 103430,
        SetNumber = 10190,
        SlotPosition = 10920,
        SniffingEnabled = 10450,
        SoliID = 10210,
        SolitaireGameLossMap = 103670,
        StoreRegion = 10900,
        StoryChoices = 1000142,
        SuspendTimestamp = 200010,
        TempInt = 10600,
        TempTarget = 10590,
        TempTargetList = 10610,
        ThemeDeckVersion = 10790,
        Timers = 10950,
        UnlockMap = 10850,
        UnrankedELOScore = 103650,
        UnrankedGameCount = 103710,
        UnrankedGameWins = 103680,
        UnrankedLastOpponentID = 103660,
        UnrankedLastPlayedTime = 103690,
        UnrankedWinLoseStreak = 103700,
        ValidatedFor = 10860,
        CampaignChoiceOffers = 103301,
        HasReceivedSpecialArenaReward = 104095,
        HydraIsWounded = 104096,
        IsSpecialRarity = 104097,
        HydraAITagList = 105110,
        HydraAIPilferBonus = 105111,
        SuperAwesomeHiglightNowPlease = 105094,
        NoEpicStreak = 104103,
        RankedSystemProgression = 1000001,
        RankedPvPELOScore = 1000002,
        RankedPvPLastOpponentID = 1000003,
        RankedPvPGameCount = 1000004,
        RankedPvPGameWins = 1000005,
        RankedPvPLastPlayedTime = 1000006,
        RankedPvPWinLoseStreak = 1000007,
        LegendPvPELOScore = 1000008,
        LegendPvPLastOpponentID = 1000009,
        LegendPvPGameCount = 1000010,
        LegendPvPGameWins = 1000011,
        LegendPvPLastPlayedTime = 1000012,
        LegendPvPWinLoseStreak = 1000013,
        CachedLegendRank = 1000014,
        PendingRankedRewards = 1000015,
        PendingSacrificeArea = 104108,
        XpRewardsCapTs = 1000130,
        XpRewardsCapAmt = 1000131,
        IsFeatureMatch = 1000132,
        AssocScenarioModifier = 1000133,
        DynamicCounts = 1000134,
        DynamicCount1 = 1000135,
        DynamicCount2 = 1000136,
        DynamicCount3 = 1000137,
        DynamicCount4 = 1000138,
        DynamicCount5 = 1000139,
        CreatedCardSource = 1000140,
        AvatarVoice = 104150,
        DamageDoneThisTurn = 1000143,
        LastGaspGhost = 1000144,
        LastGaspSource = 1000145,
        HydraIsStrengthWounded = 1004096,
        SpecialRarityType = 1004097,
        AssocEntitlementID = 1000146,
        ShouldPlayGoingSecondTutorial = 1000147,
        RankedGamesWonLessThanMinTime = 1000151,
        NoRareStreak = 1004104,
        ShackleFlavour = 103121,
        IAPOfferID = 10650,
        IABOfferID = 10660,
        KickersActivated = 1000152,
        GuildQuestDismissTime = 104031,
        AccountCreatedOn = 10487,
        HighlightList = 1000153,
        DefeatedFeatureMatches = 1000148,
        IsColdIntro = 1000155,
        EmailVerified = 10311,
        DeviceID = 10972,
        AuthMethod = 10971,
        ShouldOpenTutorialPack = 1000156,
        RankedSeasonLastReset = 1000157,
        UnlockedCampaignDecks = 1000158,
        SellbackVersion = 11020,
        AssociatedBEAMAccount = 1000160,
        CohortNames = 1000170,
        StoryLockReasons = 1000300,
        StoryDifficultyLevel = 1000301,
        StoryNodeChoices = 1000302,
        StoryNames = 1000400,
        AutoDisplay = 1000303,
        StoryNodeScriptDisplay = 1000304,
        StoryNodeOpponentsInfo = 1000305,
        OpenableOnDate = 10561,
        LastNodeInEpisode = 1000503,
        PromoCodeType = 1000506,
        HydraShoutLevel = 103550,
        MacOfferID = 103671,
        HydraAIMinValueInPlay = 105031,
        HydraAIBreakWardBonus = 105112,
        ChaosELOScore = 1000161,
        ChaosLastOpponentID = 1000162,
        ChaosGameCount = 1000163,
        ChaosGameWins = 1000164,
        ChaosLastPlayedTime = 1000165,
        ChaosWinLoseStreak = 1000166,
        ChaosLastOpponentIDs = 1000167,
        AdventureLastOpponentIDs = 103741,
        HydraExtraTurnCount = 1000507,
        SteamItemID = 10973,
        SteamPrice = 10974,
        SteamDescription = 10975,
        SteamCategory = 10976,
        HydraHeader = 103361
    }

    public static partial class Helpers
    {
        private static readonly Regex CardNumberRegex = new Regex(@"CRDL_(\d+)_(\d+)", RegexOptions.IgnoreCase);

        public static int? GetCardNumber(IReadOnlyDictionary<int, object> attrs)
        {
            if (!attrs.ContainsKey((int)Attribute.CardImage)) return null;
            var matches = CardNumberRegex.Match((string)attrs[(int)Attribute.CardImage]).Groups;
            return int.TryParse(matches[1].Value + matches[2].Value, out int result) ? result : (int?)null;
        }
    }
}
